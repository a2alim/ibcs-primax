<!--========================= transaction loader spinner ===================-->
<div *ngIf="spinner">
    <app-common-loader-spinner></app-common-loader-spinner>
</div>
<!--========================= /// transaction loader spinner ================-->
<div style="width: 100%; background-color: white">
    <div class="flex flex-col flex-auto min-w-0">

        <div
            class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between border-b bg-card dark:bg-transparent">
            <div class="flex-1 min-w-0">

                <!--New Header-->
                <div class="header flex justify-between items-center">
                    <app-list-header [title]="'headerTitle' | translate" class="crop-text"
                                     [subTitle]="'headerSubTitle' | translate"></app-list-header>
                    <div class="mr-12">
                        <a routerLink="/dpp-tapp">
                            <button class="btn btn-list hover:text-white" mat-button type="button">
                                {{'ProjectMainPage' | translate}}
                            </button>
                        </a>
                    </div>
                </div>
                <!--//New Header-->

                <!-- Header -->
                <!--<div class="dark bg-card dark:border-b">
                    <div class="flex flex-col w-full max-w-screen-xl mx-auto  sm:px-8">
                        <div class="m-5">
                            &lt;!&ndash; Avatar and name &ndash;&gt;
                            <div class="flex flex-auto items-center min-w-0">
                                <div class="flex flex-col min-w-0 ml-4">
                                    <div
                                        class="header-font-title font-semibold tracking-tight leading-7 md:leading-10 truncate">{{'page_title' | translate}}</div>
                                    <div class="flex items-center">
                                        <div class="leading-5 truncate text-secondary">
                                            <a>{{'breadcrumb1' | translate}}</a> {{'breadcrumb2' | translate}}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            &lt;!&ndash; Actions &ndash;&gt;
                            <div class="flex justify-end" style="margin-top: -50px; color: #4b4b4b !important;">
                                <a routerLink="/dpp-tapp">
                                    <button mat-button type="button">
                                        &lt;!&ndash;                                    <mat-icon>home</mat-icon>&nbsp;&ndash;&gt;
                                        {{'ProjectMainPage' | translate}}
                                    </button>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>
        <div class="flex-auto p-6 sm:p-10 outside-body">
            <mat-card style="width: 100% !important; background-color: #F0FDF4">
                <mat-card>
                    <form [formGroup]="formGroup">

                        <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                            <div fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                    <mat-label class="pb-5" fxFlex="40%" fxFlex.md="30%" fxFlex.sm="30%" fxFlex.xs="100%">
                                        {{'LinkWithProjectConcept' | translate}}:
                                    </mat-label>
                                    <mat-form-field fxFlex="60%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                        <mat-select (selectionChange)="onChangeProjectTitle($event)"
                                                    required formControlName="projectTitle">
                                            <mat-option *ngFor="let pcTitle of projectTitleList" [value]="pcTitle?.id">
                                                {{pcTitle.titleEn}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="flex justify-end">
                                <button (click)="openDialogGreenPage()" class="btn btn-add flex items-center justify-center">
                                    <mat-icon class="text-white">add</mat-icon>
                                    <p>Import from Unapproved Project</p>
                                </button>
                            </div>

                        </div>

                    </form>
                </mat-card>

                <div fxLayout="row" fxLayoutAlign="center center" *ngIf="show">
                    <mat-spinner></mat-spinner>
                </div>
                <div class="mt-2" *ngIf="form && summaryForm">
                    <form class="form p4" [formGroup]="form">

                        <!--1st Header Body Div Start -->
                        <div class="sub-heading">
                            <h1>{{'BasicInformation' | translate}}</h1>
                        </div>
                        <mat-card>
                            <div>
                                <div>
                                    <!--1st Flex Layout Div Start -->
                                    <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                        <!-- Project Code Field-->
                                        <div fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="28%" fxFlex.md="30%" fxFlex.sm="30%" fxFlex.xs="100%">
                                                    Paripatra :
                                                </mat-label>
                                                <mat-form-field fxFlex="72%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                                    <mat-select (selectionChange)="onChangeparipatraVersion($event.value)"   formControlName="paripatraVersionId" required>
                                                        <mat-option *ngFor="let paripatra of paripatraVersionList" [value]="paripatra.id">
                                                            {{paripatra.nameEn}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                        <div fxFlex="2%" fxFlex.md="0%" fxFlex.sm="0%" fxFlex.xs="0%"></div>


                                        <div fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="28%" fxFlex.md="30%" fxFlex.sm="30%"
                                                           fxFlex.xs="100%">
                                                    {{'ProjectType' | translate}}:
                                                </mat-label>
                                                <mat-form-field fxFlex="72%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                                    <mat-select (selectionChange)="onChangeProjectType($event.value)"
                                                                formControlName="projectTypeId" required>
                                                        <mat-option *ngFor="let project of projectTypeList"
                                                                    [value]="project.id">
                                                            <span *ngIf="project.nameEn == 'TAPP'">TAPP/TPP</span>
                                                            <span *ngIf="project.nameEn != 'TAPP'">{{project.nameEn}}</span>
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>


                                        <div fxFlex="2%" fxFlex.md="0%" fxFlex.sm="0%" fxFlex.xs="0%"></div>

                                        <!-- Project Type Field-->
                                        <div [hidden]="true" fxFlex="32%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="29%" fxFlex.md="30%" fxFlex.sm="30%"
                                                           fxFlex.xs="100%">{{'ProjectCode' | translate}}:
                                                </mat-label>
                                                <mat-form-field class="readOnly" fxFlex="71%" fxFlex.md="70%" fxFlex.sm="70%"
                                                                fxFlex.xs="100%">
                                                    <input formControlName="projectCode" matInput readonly>
                                                </mat-form-field>
                                            </div>
                                        </div>

                                        <div fxFlex="2%" fxFlex.md="0%" fxFlex.sm="0%" fxFlex.xs="0%"></div>

                                        <!-- Priority Field-->
                                        <div [hidden]="true" fxFlex="32%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="25%" fxFlex.md="30%" fxFlex.sm="30%"
                                                           fxFlex.xs="100%">
                                                    {{'Priority' | translate}}:
                                                </mat-label>
                                                <mat-form-field fxFlex="75%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                                    <mat-select formControlName="priorityId">
                                                        <mat-option *ngFor="let priority of priorityList" [value]="priority.id">
                                                            {{priority.nameEn}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                    <!--1st Flex Layout Div End -->

                                    <!--2nd Flex Layout Div Start -->
                                    <!-- Title Eng Field-->
                                    <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                        <mat-label class="pb-5" fxFlex="14%" fxFlex.md="30%" fxFlex.sm="30%"
                                                   fxFlex.xs="100%">{{'TitleEn' | translate}}:
                                        </mat-label>
                                        <mat-form-field fxFlex="86%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                            <textarea formControlName="titleEn" matInput placeholder="Enter Text" required></textarea>
                                        </mat-form-field>
                                    </div>

                                    <!--3th Flex Layout Div Start -->
                                    <!-- Title Bng Field-->
                                    <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                        <mat-label class="pb-5" fxFlex="14%" fxFlex.md="30%" fxFlex.sm="30%"
                                                   fxFlex.xs="100%">{{'TitleBn' | translate}}:
                                        </mat-label>
                                        <mat-form-field fxFlex="86%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                            <textarea formControlName="titleBn" matInput placeholder="Enter Text" required></textarea>
                                        </mat-form-field>
                                    </div>
                                    <!--3rd Flex Layout Div End -->

                                    <!--4nd Flex Layout Div Start -->
                                    <!-- Ministry Division Field-->
                                    <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                        <mat-label class="pb-5" fxFlex="14%" fxFlex.md="30%" fxFlex.sm="30%"
                                                   fxFlex.xs="100%">{{'MinistryDivision' | translate}}:
                                        </mat-label>
                                        <mat-form-field fxFlex="86%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%"
                                                        class="w-full readOnly">
                                            <input matInput readonly formControlName="sponsoringMinistryName">
                                        </mat-form-field>
                                    </div>

                                    <!--5th Flex Layout Div Start -->
                                    <!-- Agency Field-->
                                    <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                        <mat-label class="pb-5" fxFlex="14%" fxFlex.md="30%" fxFlex.sm="30%"
                                                   fxFlex.xs="100%">{{'ImplementingAgency' | translate}}:
                                        </mat-label>
                                        <mat-form-field fxFlex="86%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%"
                                                        class="w-full readOnly">
                                            <input matInput readonly formControlName="implementingAgencyName">
                                        </mat-form-field>
                                    </div>

                                    <br/>
                                    <!--5th Flex Layout Div End -->

                                    <div class="sub-heading">
                                        <h1>{{'ExpectedImplementationPeriod' | translate}}</h1>
                                    </div>
                                    <mat-card>
                                        <!--6th Flex Layout Div Start -->
                                        <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                            <!-- Date Of Commencement Field-->
                                            <div class="pr-5" fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                                <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                    <mat-label class="pb-5" fxFlex="45%" fxFlex.md="30%" fxFlex.sm="30%"
                                                               fxFlex.xs="100%">{{'DateOfCommencement' | translate}}:
                                                    </mat-label>
                                                    <mat-form-field fxFlex="55%" fxFlex.md="70%" fxFlex.sm="70%"
                                                                    fxFlex.xs="100%">
                                                        <input (click)="picker1.open()" [matDatepicker]="picker1"
                                                               [max]="expCommencementMaxDate"
                                                               (dateChange)="commencementDataChange($event)"
                                                               formControlName="expCommencementDate"
                                                               matInput readonly required>
                                                        <mat-datepicker-toggle [for]="picker1"
                                                                               matSuffix></mat-datepicker-toggle>
                                                        <mat-datepicker #picker1></mat-datepicker>
                                                    </mat-form-field>
                                                </div>
                                            </div>

                                            <!-- Date Of Completion Field-->
                                            <div class="pr-5" fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                                <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                    <div fxFlex="10%" fxFlex.md="0%" fxFlex.sm="0%" fxFlex.xs="0%"></div>
                                                    <mat-label class="pb-5" fxFlex="35%" fxFlex.md="30%" fxFlex.sm="30%"
                                                               fxFlex.xs="100%">{{'DateOfCompletion' | translate}}:
                                                    </mat-label>
                                                    <mat-form-field fxFlex="55%" fxFlex.md="70%" fxFlex.sm="70%"
                                                                    fxFlex.xs="100%">
                                                        <input (click)="picker2.open()" [matDatepicker]="picker2"
                                                               [min]="expCompletionMinDate"
                                                               formControlName="expCompletionDate"
                                                               (dateChange)="completionDataChange($event)"
                                                               matInput readonly required>
                                                        <mat-datepicker-toggle [for]="picker2"
                                                                               matSuffix></mat-datepicker-toggle>
                                                        <mat-datepicker #picker2></mat-datepicker>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </div>
                                        <!--6th Flex Layout Div End -->
                                    </mat-card>
                                </div>
                            </div>
                        </mat-card>
                        <!--1st Header Body Div End -->
                        <br/>
                        <!------------------------------------------------------------------------------------------------------------------------------>

                        <!--2nd Header Body Div Start -->
                        <div class="sub-heading">
                            <h1>{{'TheWorkingsOfTheGovernmentAndCOFOGSelection' | translate}}:</h1>
                        </div>
                        <mat-card>
                            <div>
                                <!--1st Flex Layout Div Start -->
                                <!-- Sector Division Field-->
                                <div fxLayout="row wrap" fxLayoutAlign="start center">
                                    <mat-label class="pb-5" fxFlex="35%" fxFlex.md="40%" fxFlex.sm="40%"
                                               fxFlex.xs="100%">{{'SectorDivision' | translate}}:
                                    </mat-label>
                                    <mat-form-field fxFlex="34%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                        <mat-select formControlName="sectorDivisionId" required
                                                    (ngModelChange)="onchangeSectorDivision($event)">
                                            <mat-option *ngFor="let sector of sectorsDivisions"
                                                        [value]="sector.id">{{sector.sectorDivisionNameEn}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <!--1st Flex Layout Div End -->

                                <mat-label class="matLabel2">
                                    <strong><u>{{'ProjectSectorAndSubSectorSection' | translate}}</u></strong></mat-label>

                                <!--2nd Flex Layout Div Start -->
                                <mat-card class="mt-2">
                                    <div fxLayout="row wrap" fxLayoutAlign="start center">
                                        <!-- Sector Field-->
                                        <div fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="16%" fxFlex.md="30%" fxFlex.sm="30%"
                                                           fxFlex.xs="100%">{{'Sector' | translate}}:
                                                </mat-label>
                                                <mat-form-field fxFlex="80%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                                    <mat-select formControlName="sectorId" required
                                                                (ngModelChange)="onchangeSector($event)">
                                                        <mat-option *ngFor="let sector of sectors"
                                                                    [value]="sector.id">{{sector.sectorNameEn}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                                <div fxFlex="4%" fxFlex.md="0%" fxFlex.sm="0%" fxFlex.xs="0%"></div>
                                            </div>
                                        </div>

                                        <!-- Sub Sector Division Field-->
                                        <div fxFlex="50%" fxFlex.md="100%" fxFlex.sm="100%" fxFlex.xs="100%">
                                            <div fxLayout="row wrap" fxLayoutAlign="space-between center">
                                                <mat-label class="pb-5" fxFlex="24%" fxFlex.md="30%" fxFlex.sm="30%"
                                                           fxFlex.xs="100%">{{'SubSector' | translate}}:
                                                </mat-label>
                                                <mat-form-field fxFlex="76%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="100%">
                                                    <mat-select formControlName="subSectorId" required
                                                                (ngModelChange)="onchangeSubSector()">
                                                        <mat-option *ngFor="let subSector of subSectors"
                                                                    [value]="subSector.id">{{subSector.subSectorNameEn}}</mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </div>
                                </mat-card>

                                <br/>
                                <mat-label class="matLabel2"><strong><u>{{'FundingType' | translate}}</u></strong>
                                </mat-label>

                                <mat-card class="mt-2">

                                    <!--4th Flex Layout Div End -->
                                    <br/>
                                    <!--5th Flex Layout Div Start -->
                                    <!-- Is Foreign Aid Field-->
                                    <div fxLayout="row wrap" fxLayoutAlign="start center">
                                        <mat-label fxFlex="16%" fxFlex.md="30%" fxFlex.sm="30%" fxFlex.xs="100%">
                                            <strong>{{'OnlyGoBFund' | translate}} </strong>:
                                        </mat-label>
                                        <mat-radio-group formControlName="isForeignAid" required fxFlex="50%" fxFlex.md="70%"
                                                         fxFlex.sm="70%"
                                                         fxFlex.xs="100%">
                                            <mat-radio-button value='false'>Yes</mat-radio-button>&nbsp;&nbsp;
                                            <mat-radio-button value='true'>No</mat-radio-button>
                                        </mat-radio-group>
                                    </div>
                                    <!--5th Flex Layout Div End -->

                                </mat-card>
                                <!--6th Flex Layout Div End -->
                            </div>
                        </mat-card>


                    </form>
                    <form class="form p4" [formGroup]="summaryForm">


                    </form>

                    <div>
                        <br>
                        <div fxLayout="row wrap" fxLayoutAlign="end" class="mr-5">


                            <!-- Save and Exit Button -->
                            <button [disabled]="spinner" *ngIf="dppSave" mat-flat-button class="mr-2"
                                    style="background-color: green; color: #FFFFFF"
                                    type="button"
                                    (click)="saveAndExit()">Save
                            </button>

                            <button [disabled]="spinner" *ngIf="dppSaveAndPcUpdate" mat-flat-button class="mr-2"
                                    style="background-color: green; color: #FFFFFF"
                                    type="button"
                                    (click)="updateAndExit()">Save
                            </button>


                        </div>
                    </div>

                </div>


            </mat-card>
        </div>
    </div>
</div>




<ng-template fxFlex="100%" fxFlex.md="70%" fxFlex.sm="70%" fxFlex.xs="70%" class="mr-20" #linkWithGreenPage>
    <div fxFlex="100" class="flex flex-col bg-card shadow rounded overflow-hidden">
        <div class="heading">
            <h1 style="float: left; padding-top: 3px;">{{'GreenPageList' | translate}}</h1>
            <span style="font-weight: normal;font-size: 14px;padding-left: 10px;">
                {{'fiscalYear' | translate}}
            </span>
            <button mat-icon-button class="close-button" [mat-dialog-close]="true" style="float: right;margin-top: -10px;"
                    (click)="closeDialog()">
                <mat-icon class="close-icon" color="warn">close</mat-icon>
            </button>
        </div>
        <mat-dialog-content class="mat-typography" style="max-height: 100%">
            <form class="p-8" style="padding: 1rem !important;">
                <div style="display: inline !important;">
                    <div >
                        <!--<mat-card>-->
                        <div class="overflow-x-auto sm:overflow-y-auto h-128" cdkScrollable>
                            <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 bg-transparent" matSort>

                                <ng-container matColumnDef="sl">
                                    <th [attr.rowspan]="2" class="table-head-style" mat-header-cell *matHeaderCellDef style="text-align: center; padding-left:0; width: 10%">
                                        Sl
                                    </th>
                                </ng-container>

                                <ng-container matColumnDef="projectInfo">
                                    <th [attr.rowspan]="7" class="table-head-style" mat-header-cell *matHeaderCellDef style="text-align: left;width: 70%">Project Information
                                    </th>
                                </ng-container>

                                <ng-container matColumnDef="gob">
                                    <th [attr.colspan]="2" class="table-head-style" mat-header-cell *matHeaderCellDef style="text-align: center;width: 10%;">Only GOB?
                                    </th>
                                </ng-container>

                                <ng-container matColumnDef="action">
                                    <th [attr.colspan]="1" class="table-head-style" mat-header-cell *matHeaderCellDef style="text-align: center;width: 10%">Action</th>
                                </ng-container>

                                <!-- ID Column -->
                                <ng-container matColumnDef="slValue">
                                    <td mat-cell *matCellDef="let row, let i= index" style="text-align: center; padding-left:0; width: 10%">
                                        <!-- {{ i + 1 }} -->
                                        {{ i + 1 }}
                                    </td>
                                </ng-container>

                                <!-- Project Info Column -->
                                <ng-container matColumnDef="projectInfoValue">
                                    <td mat-cell *matCellDef="let row" style="text-align: left;width: 65%">
                                        <div>
                                            <span style="color: #0d9488;">{{ row.project_title }}</span>
                                            <span style="color:#4b60bd;"> ({{row?.projectType}})</span>
                                        </div>
                                        <div><span style="color: #0d9488;">{{ row.project_tiltle_bn }}</span></div>
                                        <div style="color: #333333">{{ row?.agency?.agency_name }}</div>
                                        <div style="color: #333333">{{ row?.ministry?.ministry_name }}</div>
                                        <div style="color: #333333">Sector Division: <span
                                            style="color: #0d9488;">{{ row?.sectorDivision?.sectorDivisionNameEn }}</span></div>
                                        <div style="color: #333333">
                                            <span>{{'commencementDate' | translate}}</span> <span style="color: #0d9488;">{{row?.date_of_commencement | date : 'dd/MM/yyyy'}}</span>
                                            <span>   {{'completionDate' | translate}}</span> <span style="color: #0d9488;">{{ row?.date_of_completion | date : 'dd/MM/yyyy'}}</span>
                                        </div>

                                    </td>
                                </ng-container>

                                <!-- GOB Column -->
                                <ng-container matColumnDef="gobValue">
                                    <td mat-cell *matCellDef="let row" class="amount-value" style="text-align: center;width:15%;padding-left: 50px;">
                                        <div>{{ row?.isOnlyGob }}</div>
                                    </td>
                                </ng-container>

                                <!-- Action Column -->
                                <ng-container matColumnDef="actionValue">
                                    <td mat-cell *matCellDef="let row" style="text-align: center;width: 5%">
                                        <button (click)="selectGreenPage(row)" class="btn btn-add" style="margin-right: -100px;">
                                            <mat-icon class="text-white">add</mat-icon>
                                        </button>
                                    </td>
                                </ng-container>


                                <!-- Row shown when there is no matching data. -->
                                <tr class="mat-row" *matNoDataRow>
                                    <td class="mat-cell" colspan="8">
                                        No data available
                                    </td>
                                </tr>

                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumnsValue"></tr>

                            </table>

                        </div>
                    </div>
                </div>

            </form>
        </mat-dialog-content>
    </div>
</ng-template>
